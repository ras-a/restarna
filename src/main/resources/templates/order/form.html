<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
th:replace="~{/common/layout :: sidebar(title='menu', body=~{::body/content()}, head=~{:: head/content()})}">

<head>
  <meta charset="UTF-8">
  <title>お届け先、連絡先入力</title>
  <style>
    label {
      display: flex;
      flex-flow: row wrap;
      justify-content: flex-end;
      align-items: center;
      width: 4em;
      padding: 3px;

      &:hover {
        cursor: pointer;
        background-color: lightblue;
      }

      span {
        display: flex;
        align-self: flex-start;
        font-size: smaller;
        color: gray;
      }
    }

    table:has(select[name="paymentMethod"]>option[value="0"]:not(:checked)) #credit-card-row {
      display: none;
    }
  </style>
</head>

<body>
  <h2>注文詳細入力</h2>
  <div th:if="${session.name == null}">
    <form th:object="${form}" th:action="@{/item/order/complete}" method="post">
      <table>
        <tr>
          <th>支払方法</th>
          <td>
            <select th:field="*{paymentMethod}">
              <option value="0">クレジットカード</option>
              <option value="1">銀行振り込み</option>
              <option value="2">着払い</option>
              <option value="3">電子マネー</option>
              <option value="4">コンビニ決済</option>
            </select>
          </td>
        </tr>
        <tr id="credit-card-row">
          <th>クレジットカード情報</th>
          <td>
            <label class="card" th:each="card : ${session.user.creditCards}" th:for="|creditCard${card.id}|">
              <input type="radio" th:field="*{creditCard}" th:value="${card.id}">
              [[${card.name}]]<br>
              <span>...[[${#strings.substring(card.number, 12)}]]</span>
            </label>
          </td>
        </tr>
        <tr>
          <th>住所</th>
          <td>
            <label class="address" th:each="address : ${session.user.addresses}" th:for="|address${address.id}|">
              <input type="radio" th:field="*{address}" th:value="${address.id}">
              [[${address.name}]]
            </label>
          </td>
        </tr>
        <tr>
          <th>備考</th>
          <td>
            <textarea th:field="*{optionalDetails}"></textarea>
          </td>
        </tr>
        <tr>
          <td colspan="2">
            <input type="submit" value="確認">
          </td>
        </tr>
      </table>
    </form>
  </div>
  <div th:if="${session.name != null}">
    <p>郵便番号、住所を入力してください。</p>
    <form th:action="@{/item/order/complete}" method="post" th:object="${OrderForm}">
      氏名：<span th:text="${session.name}"></span><br>
      メールアドレス：<span th:text="${session.email}"></span><br><br>
      郵便番号：<input type="text" name="postCode"><br>
      住所：<input type="text" name="address"><br>
      <input type="submit" value="確認">
    </form>
  </div>

  <h2>注文内容</h2>
  <table border="1">
    <tr>
      <th>ID</th>
      <th>商品名</th>
      <th>価格</th>
      <th>個数</th>
    </tr>
    <tr th:each="c : ${session.user.cart}">
      <td th:text="${c.item.id}"></td>
      <td th:text="${c.item.name}"></td>
      <td th:text="${c.item.price}"></td>
      <td th:text="${c.quantity}"></td>
    </tr>
  </table>
  <p th:text="'合計金額：'+${totalPrice}+'円'"></p>
</body>

</html>